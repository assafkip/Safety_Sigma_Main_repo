---
title: Safety Sigma v1.1 – Pilot-Ready Compiler
doc_type: spec
authority: advisory
version: v1.1
effective_date: 2025-09-04
owner: you@company.com
links:
- /docs/policy/guardrails.md
- /docs/tests/golden_cases.md
- /docs/ir/schema.md
- /docs/validation/contract.md
---

# Overview
Goal: move from "mechanically sound, semantically incomplete" to pilot-ready compiler: rules compile for Snowflake/Sift/Unit21 with complete metadata and measured confidence (FPR/TPR), while preserving exact indicators, provenance, and governance gates.

# Requirements
- R-01 Backtest Metrics (MUST): emit TP, FP, FPR, TPR, sample_size per rule; persist with dataset hash.
- R-02 Composite Confidence (MUST): compute per-rule composite from FPR/TPR; log formula string + params. ASSUMPTION initial weighting = FPR penalty 0.8, TPR bonus 0.2 (configurable).
- R-03 Metadata Completeness (MUST): required fields = severity_label, rule_owner, detection_type, SLA, staleness_days, log_field_targets. Build fails if any missing.
- R-04 Gate Enforcement (MUST): promotion only if V-001..V-005 pass; show per-gate outcomes inline.
- R-05 Adapters (MUST): emit Snowflake SQL and JSON configs for Sift/Unit21; compiled=0 errors for bundle.
- R-06 Exact Preservation (MUST): preserve verbatim spans (e.g., $1,998.88, VOID 2000, wa.me/…); assert via golden tests and IR invariants.
- R-07 Report UX (SHOULD): HTML-first → PDF, fixed columns, monospace for rule snippets, collapsible JSON.
- R-08 Turnaround Evidence (SHOULD): log ingest→IR→rules→report timestamps; show AVG/P95; target <6h.

# Design & Alternatives
- Backtest harness A (minimal): local runner, ANSI/Snowflake SQL on sampled historical + synthetic data seeded from golden tests.
- Backtest harness B (connector): read-only Snowflake role; stratified sampling.
- Confidence formula: Composite = 1 − FPR_weighted + α·TPR_weighted; ASSUMPTION α=0.2; configurable; threshold by FPR first.

# Tests & Golden Cases
- T-01 Golden Preservation: G-001..G-003 pass on IR + compiled outputs.
- T-02 Category Grounding: G-010 diff == ∅.
- T-03 Governance Gates: visible per-rule V-001..V-005 outcomes.
- T-04 Adapter Compile: Snowflake SQL lint; Sift/Unit21 JSON schema OK.
- T-05 Backtest Sanity: seeded positives produce TP>0; seeded negatives keep FP≈0.
- T-06 Turnaround Clock: timestamps present; <6h for scoped demo run.

# Audit / Logging
Append-only: inputs, spans, rule IDs, metrics, composite formula+params, thresholds, timestamps, dataset hashes, per-gate decisions with reasons.

# Risks & Mitigations
No historical data → use synthetic + prior cases, mark advisory; adapter drift → version + smoke tests; metric gaming → dataset hashes and N_min checks.

# Exec Guarantees
Zero-inference/cite-or-omit; gates block unsafe promotion; success metrics T1≥95% preservation, T2<6h, T3=0 unsourced categories.

# Practitioner Rules
Promotion requires metrics+metadata; shadow by default; fail fast on preservation.

# Exit Criteria
1) Metrics populated (no confidence=0.000); 2) metadata complete (no missing fields); 3) report shows per-gate outcomes and only promotes all-gates-pass rules; 4) adapters compile with 0 errors; 5) <6h turnaround evidence; 6) golden tests pass on IR and compiled outputs.